      - name: Fetch food from Strapi
        env:
          STRAPI_URL: ${{ secrets.STRAPI_URL }}
          STRAPI_TOKEN: ${{ secrets.STRAPI_TOKEN }}
        run: |
          node --input-type=module -e '
          import fetch from "node-fetch";
          import fs from "fs";

          const baseUrl = process.env.STRAPI_URL.replace(/\/$/, "");
          const url = `${baseUrl}/api/foods?populate=photo`;
          const headers = { 
            Authorization: `Bearer ${process.env.STRAPI_TOKEN}`,
            Accept: "application/json"
          };

          console.log("Fetching from:", url);

          try {
            const res = await fetch(url, { headers });
            const text = await res.text();
            
            if (!res.ok) {
              console.error(`HTTP Error: ${res.status}\nContent: ${text.substring(0, 200)}`);
              process.exit(1);
            }

            const data = JSON.parse(text);
            const foods = (data.data || []).map(item => {
              const attrs = item.attributes || item;
              const photoData = attrs.photo?.data || attrs.photo;
              const photo = Array.isArray(photoData) 
                ? photoData.map(p => p.attributes?.url || p.url || "") 
                : (photoData ? [photoData.attributes?.url || photoData.url || ""] : []);
              
              return {
                id: item.id,
                name: attrs.name || "",
                amount: attrs.amount || 0,
                price: attrs.price || 0,
                shop: attrs.shop || "",
                todate: attrs.todate || "",
                photo: photo.filter(Boolean),
                photoHash: attrs.photoHash || ""
              };
            });

            fs.writeFileSync("food.json", JSON.stringify(foods, null, 2));
            console.log(`Success: ${foods.length} items saved.`);
          } catch (error) {
            console.error("Script Error:", error.message);
            process.exit(1);
          }
          '
